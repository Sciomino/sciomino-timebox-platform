MCOW.Model.Timebox.availability={run:function(){var e=TIMEBOX.Lib.getCredentials(),t=MCOW.Session.Request.param.date;MCOW.Session.Response.param.newDate=t,MCOW.Session.Response.param.current=TIMEBOX.Lib.getAvailability("current"),MCOW.Session.Response.param.future=TIMEBOX.Lib.getAvailability("future"),MCOW.Model.Timebox.availability.callback()},callback:function(){MCOW.Event.Control.modelCallback()}},MCOW.Model.Timebox.calendar={run:function(){var e=TIMEBOX.Lib.getCredentials(),t=new Array,n=6;for(var r=0;r<n;r++)t[r]=MCOW.Model.Timebox.calendar.getNewCalendar(r);MCOW.Session.Response.param.calendarList=t,MCOW.Model.Timebox.calendar.callback()},callback:function(){MCOW.Event.Control.modelCallback()},getNewCalendar:function(e){var t={},n=new Array,r=["Januari","Februari","Maart","April","Mei","Juni","Juli","Augustus","September","Oktober","November","December"],i=1,s=new Date,o=s.getFullYear(),u=s.getMonth()+e;u>=12&&(u-=12,o+=1);var a=r[u],f=0;e==0&&(f=s.getDate());var l=new Date(o,u,1),c=l.getDay(),h=new Date(o,u+1,0),p=h.getDate();c==0?c=6:c--,$count=1;for(var d=0;d<=5;d++){n[d]=new Array;for(var v=0;v<=6;v++)$count<=p?d==0?v<c?n[d][v]=0:(n[d][v]=$count,$count++):(n[d][v]=$count,$count++):n[d][v]=0}return t.year=o,t.month=u,t.monthString=a,t.day=f,t.calendar=n,t}},MCOW.Model.Timebox.email={run:function(){var e=TIMEBOX.Lib.getCredentials(),t=MCOW.Session.Request.param.go,n=document.forms.emailForm;if(t==1&&n&&MCOW.Util.getParentElementById(n,"page")!=null){$("#loader").removeClass("hidden");var r=n.elements.walkthroughemail.value;e.email=r,TIMEBOX.Lib.setCredentials(e);var i="?name="+e.name;i=i+"&email="+e.email,MCOW.Connection.getResponse(TIMEBOX.Config["timebox-url"]+"mobile/authorize"+i,function(e){MCOW.Model.Timebox.email.callbackFromUrl(e)})}else MCOW.Model.Timebox.email.callback()},callback:function(){MCOW.Event.Control.modelCallback()},callbackFromUrl:function(e){e.error?MCOW.Config["target"]=="phonegap"?navigator.notification.alert("There is currently no network available",null,"No Network","Ok"):alert("error:"+e.error):e.content["status"]=="1"?MCOW.Event.fire("/Timebox/pin"):(TIMEBOX.Lib.resetCredentials(),MCOW.Session.Response.param.error=e.content.message,MCOW.Event.Control.modelCallback())}},MCOW.Model.Timebox.home={run:function(){var e=TIMEBOX.Lib.getCredentials();if(typeof e["email"]=="undefined"||e["email"]==""){MCOW.Event.fire("/Timebox/email");return}if(typeof e["secret"]=="undefined"||e["secret"]==""){MCOW.Event.fire("/Timebox/pin");return}var t=TIMEBOX.Lib.getSkin();MCOW.Session.Response.param.background=t.background,MCOW.Model.Timebox.home.initPersonalia()},callback:function(){MCOW.Event.Control.modelCallback()},initPersonalia:function(){var e=TIMEBOX.Lib.getPersonalia();if(e["sync"]==-1){var t=TIMEBOX.Lib.getTokenString(),n="?"+t;MCOW.Connection.getResponse(TIMEBOX.Config["timebox-url"]+"mobile/user-personalia-list"+n,function(e){MCOW.Model.Timebox.home.callbackPersonalia(e)})}else MCOW.Session.Response.param.photoStream=e.photoStream,window.Worker||TIMEBOX.Lib.syncPersonalia(),MCOW.Model.Timebox.home.initAvailability()},callbackPersonalia:function(e){e.error?MCOW.Config["target"]=="phonegap"?navigator.notification.alert("There is currently no network available",null,"No Network","Ok"):alert("error:"+e.error):(MCOW.Session.Response.param.photoStream=e.content.photoStream,TIMEBOX.Lib.setPersonalia(e.content,0)),MCOW.Model.Timebox.home.initAvailability()},initAvailability:function(){var e=TIMEBOX.Lib.getAvailability("current"),t=TIMEBOX.Lib.getAvailability("future");if(e["sync"]==-1&&t["sync"]==-1){var n=TIMEBOX.Lib.getTokenString(),r="?"+n;MCOW.Connection.getResponse(TIMEBOX.Config["timebox-url"]+"mobile/user-availability-list"+r,function(e){MCOW.Model.Timebox.home.callbackAvailability(e)})}else MCOW.Session.Response.param.current=e,MCOW.Session.Response.param.future=t,window.Worker||TIMEBOX.Lib.syncAvailability(),MCOW.Model.Timebox.home.initShares()},callbackAvailability:function(e){e.error?MCOW.Config["target"]=="phonegap"?navigator.notification.alert("There is currently no network available",null,"No Network","Ok"):alert("error:"+e.error):(MCOW.Session.Response.param.current=e.content.current,MCOW.Session.Response.param.future=e.content.future,TIMEBOX.Lib.setAvailability("current",e.content.current,0),TIMEBOX.Lib.setAvailability("future",e.content.future,0)),MCOW.Model.Timebox.home.initShares()},initShares:function(){var e=TIMEBOX.Lib.getShares();if(e["sync"]==-1){var t=TIMEBOX.Lib.getTokenString(),n="?"+t;MCOW.Connection.getResponse(TIMEBOX.Config["timebox-url"]+"mobile/user-availability-list-network"+n,function(e){MCOW.Model.Timebox.home.callbackShares(e)})}else MCOW.Session.Response.param.networks=e.networks,MCOW.Session.Response.param.networkCount=TIMEBOX.Lib.countShares(e.networks),window.Worker||TIMEBOX.Lib.syncShares(),MCOW.Event.Control.modelCallback()},callbackShares:function(e){e.error?MCOW.Config["target"]=="phonegap"?navigator.notification.alert("There is currently no network available",null,"No Network","Ok"):alert("error:"+e.error):(MCOW.Session.Response.param.networks=e.content.networks,MCOW.Session.Response.param.networkCount=TIMEBOX.Lib.countShares(e.content.networks),TIMEBOX.Lib.setShares(e.content,0)),MCOW.Event.Control.modelCallback()}},MCOW.Model.Timebox.pin={run:function(){var e=TIMEBOX.Lib.getCredentials();MCOW.Session.Response.param.email=e.email;var t=MCOW.Session.Request.param.go,n=MCOW.Session.Request.param.code,r=document.forms.pinForm;if(t==1&&r&&MCOW.Util.getParentElementById(r,"page")!=null){$("#loader").removeClass("hidden");var i=r.elements.registerpin.value,s=MCOW.Util.sha1(e.name+e.email+i),o="?name="+e.name;o=o+"&email="+e.email,o=o+"&key="+s,MCOW.Connection.getResponse(TIMEBOX.Config["timebox-url"]+"mobile/token"+o,function(e){MCOW.Model.Timebox.pin.callbackFromUrl(e)})}else MCOW.Session.Response.param.code=n,MCOW.Model.Timebox.email.callback()},callback:function(){MCOW.Event.Control.modelCallback()},callbackFromUrl:function(e){if(e.error)MCOW.Config["target"]=="phonegap"?navigator.notification.alert("There is currently no network available",null,"No Network","Ok"):alert("error:"+e.error);else if(e.content["status"]=="1"){var t=TIMEBOX.Lib.getCredentials(),n=document.forms.pinForm,r=n.elements.registerpin.value;t.secret=r,t.token=e.content.token,MCOW.Config["debug_credentials"]=="1"&&console.log("Timebox.pin credentials: "+JSON.stringify(t)),TIMEBOX.Lib.setCredentials(t),e.content["new"]=="1"?MCOW.Event.fire("/Timebox/wizard"):MCOW.Event.fire("/Timebox/home")}else MCOW.Session.Response.param.error=e.content.message,MCOW.Event.Control.modelCallback()}},MCOW.Model.Timebox.share={run:function(){var e=TIMEBOX.Lib.getCredentials();MCOW.Session.Response.param.email=e.email;var t=TIMEBOX.Lib.getShares();MCOW.Session.Response.param.networks=t.networks,MCOW.Model.Timebox.share.callback()},callback:function(){MCOW.Event.Control.modelCallback()}},MCOW.Model.Timebox.wizard={run:function(){var e=TIMEBOX.Lib.getCredentials(),t=MCOW.Session.Request.param.go,n=document.forms.wizardForm;if(t==1&&n&&MCOW.Util.getParentElementById(n,"page")!=null){var r=n.elements.firstname.value,i=n.elements.lastname.value,s=n.elements.gender.value,o=n.elements.dateofbirthday.value,u=n.elements.dateofbirthmonth.value,a=n.elements.dateofbirthyear.value;if(r!=""&&i!=""&&s!=""&&o!="day"&&u!="month"&&a!="year"){var f=TIMEBOX.Lib.getPersonalia();f.firstname=r,f.lastname=i,f.gender=s,f.dateofbirthday=o,f.dateofbirthmonth=u,f.dateofbirthyear=a,TIMEBOX.Lib.setPersonalia(f,1),MCOW.Event.fire("/Timebox/home")}else MCOW.Session.Response.param.error="Please, fill in the complete form.",MCOW.Session.Response.param.firstname=r,MCOW.Session.Response.param.lastname=i,MCOW.Session.Response.param.gender=s,MCOW.Session.Response.param.dateofbirthday=o,MCOW.Session.Response.param.dateofbirthmonth=u,MCOW.Session.Response.param.dateofbirthyear=a,MCOW.Model.Timebox.wizard.callback()}else MCOW.Model.Timebox.wizard.callback()},callback:function(){MCOW.Event.Control.modelCallback()}};